# ============================================================================
# PATRONI CLUSTER CONFIGURATION
# ============================================================================

# -----------------------------------------------------------------------------
# CLUSTER IDENTITY
# -----------------------------------------------------------------------------
PATRONI_SCOPE=pg-cluster      # Cluster identifier
PATRONI_NAMESPACE=/patroni    # Namespace prefix

# -----------------------------------------------------------------------------
# ETCD CONFIGURATION
# -----------------------------------------------------------------------------
# ETCD cluster endpoints
PATRONI_ETCD3_HOSTS=etcd1:2379,etcd2:2379,etcd3:2379

# -----------------------------------------------------------------------------
# POSTGRESQL CONFIGURATION
# -----------------------------------------------------------------------------
POSTGRES_USER=area_user
POSTGRES_PASSWORD=area_password
POSTGRES_DB=area

# Replication user
REPLICATION_USER=replicator
REPLICATION_PASSWORD=replpass
PATRONI_REPLICATION_USERNAME=replicator
PATRONI_REPLICATION_PASSWORD=replpass

# Superuser password (for REST API and management)
SUPERUSER_PASSWORD=postgres
PATRONI_SUPERUSER_USERNAME=area_user
PATRONI_SUPERUSER_PASSWORD=area_password

# Data directory
PATRONI_POSTGRESQL_DATA_DIR=/var/lib/postgresql/data/pgdata

# -----------------------------------------------------------------------------
# POSTGRESQL TUNING (applied via Patroni bootstrap)
# -----------------------------------------------------------------------------
PG_MAX_CONNECTIONS=100
PG_SHARED_BUFFERS=256MB
PG_EFFECTIVE_CACHE_SIZE=768MB
PG_MAINTENANCE_WORK_MEM=64MB
PG_WAL_BUFFERS=8MB
PG_MAX_WAL_SENDERS=10
PG_MAX_REPLICATION_SLOTS=10
PG_HOT_STANDBY=on
PG_WAL_LEVEL=replica
PG_WAL_LOG_HINTS=on

# -----------------------------------------------------------------------------
# PATRONI SETTINGS
# -----------------------------------------------------------------------------
# Time To Live for the leader lock
# Rule: TTL > loop_wait + retry_timeout
PATRONI_TTL=5

# How often Patroni checks cluster state (in seconds)
PATRONI_LOOP_WAIT=1

# How long to retry DCS operations before giving up
PATRONI_RETRY_TIMEOUT=3

# Maximum replication lag (bytes) allowed for a replica to be promoted
PATRONI_MAXIMUM_LAG_ON_FAILOVER=1048576
