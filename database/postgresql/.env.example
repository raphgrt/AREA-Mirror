# ============================================================================
# PATRONI CLUSTER CONFIGURATION
# ============================================================================

# -----------------------------------------------------------------------------
# CLUSTER IDENTITY
# -----------------------------------------------------------------------------
PATRONI_SCOPE=pg-cluster      # Cluster identifier
PATRONI_NAMESPACE=/patroni    # Namespace prefix

# -----------------------------------------------------------------------------
# ETCD CONFIGURATION
# -----------------------------------------------------------------------------
# ETCD cluster endpoints
PATRONI_ETCD3_HOSTS=<ip-etcd-1>:2379,<ip-etcd-2>:2379,<ip-etcd-3>:2379

# -----------------------------------------------------------------------------
# NODE CONFIGURATION
# -----------------------------------------------------------------------------
# Node 1
NODE1_NAME=postgres-1
NODE1_HOST=postgres-1
NODE1_POSTGRES_PORT=5432
NODE1_API_PORT=8008

# Node 2
NODE2_NAME=postgres-2
NODE2_HOST=postgres-2
NODE2_POSTGRES_PORT=5432
NODE2_API_PORT=8008

# Node 3
NODE3_NAME=postgres-3
NODE3_HOST=postgres-3
NODE3_POSTGRES_PORT=5432
NODE3_API_PORT=8008

# -----------------------------------------------------------------------------
# POSTGRESQL CONFIGURATION
# -----------------------------------------------------------------------------
POSTGRES_USER=area_user
POSTGRES_PASSWORD=area_password
POSTGRES_DB=area

# Replication user
REPLICATION_USER=replicator
REPLICATION_PASSWORD=replpass
PATRONI_REPLICATION_USERNAME=replicator
PATRONI_REPLICATION_PASSWORD=replpass

# Superuser password (for REST API and management)
SUPERUSER_PASSWORD=area_password
PATRONI_SUPERUSER_USERNAME=area_user
PATRONI_SUPERUSER_PASSWORD=area_password

# Data directory
PATRONI_POSTGRESQL_DATA_DIR=/var/lib/postgresql/data/pgdata

# -----------------------------------------------------------------------------
# POSTGRESQL TUNING
# -----------------------------------------------------------------------------
PG_MAX_CONNECTIONS=100
PG_SHARED_BUFFERS=256MB
PG_EFFECTIVE_CACHE_SIZE=768MB
PG_MAINTENANCE_WORK_MEM=64MB
PG_WAL_BUFFERS=8MB
PG_MAX_WAL_SENDERS=10
PG_MAX_REPLICATION_SLOTS=10
PG_HOT_STANDBY=on
PG_WAL_LEVEL=replica
PG_WAL_LOG_HINTS=on

# -----------------------------------------------------------------------------
# PATRONI SETTINGS
# -----------------------------------------------------------------------------
# Time To Live for the leader lock
# Rule: TTL > loop_wait + retry_timeout
PATRONI_TTL=5

# How often Patroni checks cluster state (in seconds)
PATRONI_LOOP_WAIT=1

# How long to retry DCS operations before giving up
PATRONI_RETRY_TIMEOUT=3

# Maximum replication lag (bytes) allowed for a replica to be promoted
PATRONI_MAXIMUM_LAG_ON_FAILOVER=1048576

# -----------------------------------------------------------------------------
# HOST PORT MAPPING (external access)
# -----------------------------------------------------------------------------
HOST_POSTGRES_PORT_1=5432
HOST_POSTGRES_PORT_2=5433
HOST_POSTGRES_PORT_3=5434
HOST_API_PORT_1=8008
HOST_API_PORT_2=8009
HOST_API_PORT_3=8010
